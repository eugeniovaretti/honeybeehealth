---
title: "R Notebook"
output: html_notebook
---

```{r}
data_cleaned
```
```{r}
dim(stressor)
levels(factor(stressor$stressor))
```




# trattiamo separatamnte i dati per anno (e.g 2020)
```{r}
data_2020 <- data_cleaned[data_cleaned$year == 2020,]
data_2020
```
# Vediamo andamento per California nei 4 trimestri:
```{r}
# i <- which(data_2020$state == "Montana")
# data_mont <- data_2020[i,]
```
```{r}
i = which(stressor$state == "California" & stressor$year == 2021)
plot(x=factor(stressor$stressor[i]), y=stressor$stress_pct[i])
```

PLOTTO PERCENTUALI DI COLONY_LOST NEL 2020 PER OGNI STATO
```{r}
library(plotly)
us_data <- map_data("state")

colony_plot <- colony
colony_plot$state <- tolower(colony_plot$state)
cv <- colony_plot[colony_plot$year == 2020,c(3,7)]
cv$state <- factor(cv$state)
cv[is.na(cv$colony_lost_pct),2]<-0 
agg = aggregate(cv,
                by = list(cv$state),
                FUN = mean,
                )

agg <- agg[,-2]



df <- data.frame(
  state = agg[,1],
  values = agg[,2]
)

library(usmap)
plot_usmap(data = df) + labs(title = "Colony lost percentage in 2020")
#nota che gli stati vuoti sarebbero in Others
```

Plotto nel tempo percentuale di colonie perse per stato e percentuale di Varroa Mites.
Magari riesco a trovare una correlazione tra i due dati funzionali - (magari laggando nel
tempo gli stressori)

```{r}
state <- factor(colony$state)
i <- which(state=="California")
length(i)
x_time <- rep(1:30)


i_stres <- which(stressor$state == "California")

i_s_var <- which(stressor[i_stres,"stressor"]=="Varroa mites")
i_s_op <- which(stressor[i_stres,"stressor"]=="Other pests/parasites")
i_s_dis <- which(stressor[i_stres,"stressor"]=="Disesases")
i_s_pes <- which(stressor[i_stres,"stressor"]=="Pesticides")
i_s_oth <- which(stressor[i_stres,"stressor"]=="Other")
i_s_unk <- which(stressor[i_stres,"stressor"]=="Unknown")


matplot(x_time, colony[i,"colony_lost_pct"], type="l", ylim=c(0,60), ylab="Percentage")
lines(x_time, stressor[i_s_var,"stress_pct"], col = "red")
lines(x_time, stressor[i_s_op,"stress_pct"], col = "green")
lines(x_time, stressor[i_s_dis,"stress_pct"], col = "blue")
lines(x_time, stressor[i_s_pes,"stress_pct"], col = "orange")
lines(x_time, stressor[i_s_oth,"stress_pct"], col = "purple")
lines(x_time, stressor[i_s_unk,"stress_pct"], col = "brown")

legend("topright", legend=c("Colonylostpct","Varroa", "Other Pest", "Disesases", "Pesticides", "Other", "Unknown"),
       col=c("black","red", "green", "blue", "orange", "purple", "brown" ), cex=0.8, lwd = 1)
title("CALIFORNIA - Andamento negli anni colony_lost vs Stressors")

```
Pe rvedere differenza estate inverno:
```{r}
data_cleanedpct <- read.csv("../../data/cleaned_data_withpct.csv")
#data_cleanedpct<-data_cleanedpct[,-c(1,2)]

months <- factor(data_cleanedpct$months)

```























